{% extends 'base.html' %}
{% load static %}

{% block title %}Team Members â€¢ HR System{% endblock %}

{% block content %}
<style>
    /* Reuse the same CSS from other pages */
    :root {
        --primary: #4361ee;
        --primary-light: #4895ef;
        --secondary: #7209b7;
        --accent: #4cc9f0;
        --warning: #f72585;
        --success: #10b981;
        --danger: #ef4444;
        --dark: #1a1a2e;
        --light: #f8f9fa;
        --gray-100: #f8f9fa;
        --gray-200: #e9ecef;
        --gray-300: #dee2e6;
        --gray-400: #ced4da;
        --gray-500: #adb5bd;
        --gray-600: #6c757d;
        --gray-700: #495057;
        --gray-800: #343a40;
        --gray-900: #212529;
        --white: #ffffff;
        --card-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        --hover-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background-color: #f8fafc;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        color: var(--gray-800);
    }

    .page-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
    }

    /* Header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--gray-200);
    }

    .page-header h1 {
        font-size: 30px;
        font-weight: 700;
        color: var(--dark);
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .page-header h1 i {
        color: var(--primary);
        background: rgba(67, 97, 238, 0.1);
        padding: 12px;
        border-radius: 12px;
    }

    .page-subtitle {
        font-size: 16px;
        color: var(--gray-600);
        margin-top: 4px;
        max-width: 600px;
    }

    .stats-badge {
        background: var(--white);
        border: 1px solid var(--gray-200);
        padding: 10px 20px;
        border-radius: 12px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Search and Filter Card */
    .filter-card {
        background: var(--white);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: var(--card-shadow);
        border: 1px solid var(--gray-200);
    }

    .search-box {
        position: relative;
        max-width: 400px;
    }

    .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-500);
        font-size: 16px;
    }

    .search-input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        border: 1px solid var(--gray-300);
        border-radius: 10px;
        font-size: 14px;
        color: var(--dark);
        background: var(--white);
        transition: all 0.2s ease;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    /* Main Container */
    .main-container {
        background: var(--white);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        border: 1px solid var(--gray-200);
    }

    .table-header {
        padding: 24px;
        border-bottom: 1px solid var(--gray-200);
        background: var(--white);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .table-header h3 {
        font-size: 18px;
        font-weight: 600;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .count-badge {
        background: var(--primary);
        color: white;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
    }

    .table-container {
        padding: 10px;
        overflow-x: auto;
    }

    .dataTable {
        width: 100%;
        border-collapse: collapse;
        min-width: 1000px;
    }

    .dataTable thead {
        background: var(--gray-100);
    }

    .dataTable th {
        padding: 16px 20px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: var(--gray-700);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--gray-200);
        white-space: nowrap;
    }

    .dataTable tbody tr {
        border-bottom: 1px solid var(--gray-100);
        transition: all 0.2s ease;
    }

    .dataTable tbody tr:hover {
        background: rgba(67, 97, 238, 0.03);
    }

    .dataTable td {
        padding: 16px 20px;
        font-size: 14px;
        color: var(--gray-800);
        vertical-align: middle;
    }

    /* Employee Info */
    .employee-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .employee-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
        overflow: hidden;
    }

    .employee-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
    }

    .avatar-placeholder {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    .employee-details {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .employee-name {
        font-weight: 600;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .employee-id {
        font-size: 12px;
        color: var(--gray-500);
        background: var(--gray-100);
        padding: 2px 8px;
        border-radius: 4px;
        display: inline-block;
    }

    /* Department Badge */
    .dept-badge {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary);
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid rgba(67, 97, 238, 0.2);
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    /* Designation Badge */
    .designation-badge {
        background: rgba(76, 201, 240, 0.1);
        color: #0c4a6e;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid rgba(76, 201, 240, 0.2);
    }

    /* Status Badges */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
    }

    .badge-active {
        background: rgba(16, 185, 129, 0.1);
        color: #065f46;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .badge-inactive {
        background: rgba(100, 116, 139, 0.1);
        color: #475569;
        border: 1px solid rgba(100, 116, 139, 0.2);
    }

    .badge-on-leave {
        background: rgba(247, 37, 133, 0.1);
        color: #9d174d;
        border: 1px solid rgba(247, 37, 133, 0.2);
    }

    /* Contact Info */
    .contact-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .email {
        font-weight: 500;
        color: var(--dark);
    }

    .phone {
        font-size: 12px;
        color: var(--gray-500);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        background: var(--gray-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
        color: var(--gray-500);
        font-size: 32px;
    }

    .empty-state h4 {
        font-size: 18px;
        color: var(--dark);
        margin-bottom: 8px;
    }

    .empty-state p {
        color: var(--gray-600);
        max-width: 400px;
        margin: 0 auto 24px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-container {
            padding: 16px;
        }
       
        .page-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }
       
        .filter-card {
            padding: 20px;
        }
       
        .table-header {
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }
       
        .dataTable {
            min-width: 1000px;
        }
       
        .dataTable th,
        .dataTable td {
            padding: 12px 16px;
        }
    }

    /* Department Header */
    .dept-header {
        /* background: #ffffff; */
        color: #000000;
        padding: 20px 24px;
        border-radius: 12px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        box-shadow: var(--card-shadow);
        justify-content: space-between;
    }

    .dept-header-content {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .dept-icon {
        width: 48px;
        height: 48px;
        background: rgb(32 58 203 / 44%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .dept-title {
        font-size: 33px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .dept-subtitle {
        font-size: 14px;
        opacity: 0.9;
    }

    /* Pagination */
    .custom-pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        padding: 24px;
        border-top: 1px solid var(--gray-200);
    }

    .page-btn {
        background: var(--white);
        border: 1px solid var(--gray-300);
        color: var(--gray-700);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .page-btn:hover:not(:disabled) {
        background: var(--gray-100);
        border-color: var(--gray-400);
        transform: translateY(-1px);
    }

    .page-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .page-info {
        font-size: 14px;
        color: var(--gray-600);
        margin: 0 12px;
    }
</style>

<div class="page-container">
    <!-- Department Header -->
    <div class="dept-header">
        <div class="dept-header-content">
            <div class="dept-icon">
                <i class="fas fa-users"></i>
            </div>
            <div>
                <div class="dept-title">Team Members</div>
                <div class="dept-subtitle">
                    <i class="fas fa-building me-1"></i>
                    {{ employee.department|default:"No Department Assigned" }}
                </div>
            </div>
        </div>
        <!-- <div class="stats-badge" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: #000000;">
            <i class="fas fa-user-friends"></i>
            {{ team_members|length }} Team Member{{ team_members|length|pluralize:"s" }}
        </div> -->
    </div>

    <!-- Search Card -->
    <div class="filter-card">
        <div class="search-box">
            <i class="fas fa-search search-icon"></i>
            <input type="text"
                   class="search-input"
                   id="searchInput"
                   placeholder="Search team members by name, email, or employee ID..."
                   autocomplete="off">
        </div>
    </div>

    <!-- Team Members Table -->
    <div class="main-container">
        <div class="table-header">
            <h3>
                <i class="fas fa-list"></i>
                All Team Members
            </h3>
            <div class="count-badge" id="teamCount">
                {{ team_members|length }} Members
            </div>
        </div>
       
        <div class="table-container">
            {% if team_members %}
            <table class="dataTable" id="teamMembersTable">
                <thead>
                    <tr>
                        <th>Team Member</th>
                        <th>Contact Info</th>
                        <th>Designation</th>
                        <th>Department</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    {% for member in team_members %}
                    <tr class="team-member-row">
                        <!-- Team Member Details -->
                        <td>
                            <div class="employee-info">
                                <div class="employee-avatar">
                                    {% if member.profile_picture %}
                                        <img src="{{ member.profile_picture.url }}" alt="{{ member.first_name }}">
                                    {% else %}
                                        <div class="avatar-placeholder">
                                            {{ member.first_name|first|upper }}{{ member.last_name|first|upper }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="employee-details">
                                    <div class="employee-name">
                                        {{ member.first_name }} {{ member.last_name }}
                                        {% if member.employee_id %}
                                            <span class="employee-id">ID: {{ member.employee_id }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </td>
                       
                        <!-- Contact Info -->
                        <td>
                            <div class="contact-info">
                                <div class="email">
                                    <i class="fas fa-envelope me-1"></i>
                                    {{ member.email|default:"-" }}
                                </div>
                                {% if member.phone %}
                                <div class="phone">
                                    <i class="fas fa-phone me-1"></i>
                                    {{ member.phone }}
                                </div>
                                {% endif %}
                            </div>
                        </td>
                       
                        <!-- Designation -->
                        <td>
                            {% if member.designation %}
                                <span class="designation-badge">
                                    <i class="fas fa-user-tie me-1"></i>
                                    {{ member.designation }}
                                </span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                       
                        <!-- Department -->
                        <td>
                            {% if member.department %}
                                <span class="dept-badge">
                                    <i class="fas fa-building me-1"></i>
                                    {{ member.department }}
                                </span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                       
                        <!-- Status -->
                        <td>
                            {% if member.status == 'active' %}
                                <span class="status-badge badge-active">
                                    <i class="fas fa-check-circle"></i>
                                    Active
                                </span>
                            {% elif member.status == 'on_leave' %}
                                <span class="status-badge badge-on-leave">
                                    <i class="fas fa-umbrella-beach"></i>
                                    On Leave
                                </span>
                            {% else %}
                                <span class="status-badge badge-inactive">
                                    <i class="fas fa-times-circle"></i>
                                    Inactive
                                </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h4>No Team Members Found</h4>
                <p>You're the only one in this department or no department has been assigned to you.</p>
            </div>
            {% endif %}
        </div>

        <!-- Pagination -->
        {% if team_members %}
        <div class="custom-pagination" id="paginationContainer">
            <button class="page-btn" id="prevBtn" disabled>
                <i class="fas fa-chevron-left"></i>
                Previous
            </button>
            <span class="page-info" id="pageInfo">Page 1 of 1</span>
            <button class="page-btn" id="nextBtn" disabled>
                Next
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const rowsPerPage = 10;
    const tableBody = document.getElementById('tableBody');
    const searchInput = document.getElementById('searchInput');
    const teamCount = document.getElementById('teamCount');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const pageInfo = document.getElementById('pageInfo');
    const paginationContainer = document.getElementById('paginationContainer');
    
    let allRows = Array.from(tableBody.getElementsByClassName('team-member-row'));
    let currentPage = 1;
    let filteredRows = allRows;

    function updateTable() {
        // Filter rows based on search
        const searchTerm = searchInput.value.toLowerCase().trim();
        filteredRows = allRows.filter(row => {
            const text = row.textContent.toLowerCase();
            return text.includes(searchTerm);
        });

        // Update count
        teamCount.textContent = `${filteredRows.length} Member${filteredRows.length !== 1 ? 's' : ''}`;
        
        // Calculate pagination
        const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
        currentPage = Math.min(currentPage, totalPages || 1);
        
        // Get rows for current page
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;
        const pageRows = filteredRows.slice(startIndex, endIndex);
        
        // Clear and add rows
        tableBody.innerHTML = '';
        pageRows.forEach(row => tableBody.appendChild(row));
        
        // Update pagination controls
        updatePagination(totalPages);
    }

    function updatePagination(totalPages) {
        if (totalPages <= 1) {
            paginationContainer.style.display = 'none';
            return;
        }
        
        paginationContainer.style.display = 'flex';
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        
        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage === totalPages;
        
        // Remove existing page number buttons
        const existingPageBtns = paginationContainer.querySelectorAll('.page-num');
        existingPageBtns.forEach(btn => btn.remove());
        
        // Add page number buttons
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);
        
        if (startPage > 1) {
            addPageButton(1);
            if (startPage > 2) {
                const ellipsis = document.createElement('span');
                ellipsis.className = 'page-info';
                ellipsis.textContent = '...';
                prevBtn.after(ellipsis);
            }
        }
        
        for (let i = startPage; i <= endPage; i++) {
            addPageButton(i);
        }
        
        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                const ellipsis = document.createElement('span');
                ellipsis.className = 'page-info';
                ellipsis.textContent = '...';
                nextBtn.before(ellipsis);
            }
            addPageButton(totalPages);
        }
    }

    function addPageButton(pageNum) {
        const btn = document.createElement('button');
        btn.className = `page-btn page-num ${pageNum === currentPage ? 'active' : ''}`;
        btn.textContent = pageNum;
        btn.addEventListener('click', () => {
            currentPage = pageNum;
            updateTable();
        });
        nextBtn.before(btn);
    }

    // Event Listeners
    searchInput.addEventListener('input', () => {
        currentPage = 1;
        updateTable();
    });

    prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            updateTable();
        }
    });

    nextBtn.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            updateTable();
        }
    });

    // Initialize
    updateTable();
});
</script>
{% endblock %}