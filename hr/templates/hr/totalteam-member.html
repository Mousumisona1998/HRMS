{% extends 'base.html' %}
{% load static %}

{% block title %}Team Members{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Page Title & Search -->
    <div class="d-flex justify-content-between align-items-center flex-wrap mb-3 mt-0">
    <h4 style="
            background: linear-gradient(180deg, #2c3e50 0%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin: 0;">
        Team Members in {{ employee.department|default:"N/A" }}
    </h4>
    <form id="searchForm" class="d-flex" style="max-width: 300px;">
        <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="Search team member...">
    </form>
</div>


    <!-- Table Card -->
    <div class="custom-card shadow-sm bg-white p-3 rounded-4">
        {% if team_members %}
        <div class="table-responsive text-center">
            <table class="table table-hover table-striped align-middle" id="teamMembersTable">
                <thead class="table-primary">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Designation</th>
                        <th>Department</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    {% for member in team_members %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="avatar-sm me-3">
                                    {% if member.profile_picture %}
                                        <img src="{{ member.profile_picture.url }}" alt="{{ member.first_name }}" class="rounded-circle" width="32" height="32">
                                    {% else %}
                                        <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                            <i class="fas fa-user text-white" style="font-size: 0.8rem;"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div>
                                    <strong>{{ member.first_name }} {{ member.last_name }}</strong>
                                    {% if member.employee_id %}
                                        <br><small class="text-muted">ID: {{ member.employee_id }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                        <td>{{ member.email }}</td>
                        <td>{{ member.phone|default:"-" }}</td>
                        <td>{{ member.designation|default:"-" }}</td>

                        <td>{{ member.department }}</td>
                        <td>
                            <span class="badge {% if member.status == 'active' %}bg-success{% else %}bg-warning{% endif %}">
                                {{ member.status|title }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav class="mt-3">
            <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-users text-muted mb-3" style="font-size: 3rem;"></i>
            <h5 class="text-muted">No Team Members Found</h5>
            <p class="text-muted">Youâ€™re the only one in this department or department is not assigned.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- JS for Search + Pagination -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const rowsPerPage = 5;
    const tableBody = document.getElementById('tableBody');
    const pagination = document.getElementById('pagination');
    const searchInput = document.getElementById('searchInput');
    const rows = Array.from(tableBody.getElementsByTagName('tr'));

    function renderTable(filteredRows, page = 1) {
        tableBody.innerHTML = '';
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const paginatedRows = filteredRows.slice(start, end);
        paginatedRows.forEach(row => tableBody.appendChild(row));
        renderPagination(filteredRows.length, page);
    }

    function renderPagination(totalRows, currentPage) {
        pagination.innerHTML = '';
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            li.classList.add('page-item');
            if (i === currentPage) li.classList.add('active');
            const link = document.createElement('a');
            link.classList.add('page-link');
            link.textContent = i;
            link.href = '#';
            link.addEventListener('click', (e) => {
                e.preventDefault();
                renderTable(getFilteredRows(), i);
            });
            li.appendChild(link);
            pagination.appendChild(li);
        }
    }

    function getFilteredRows() {
        const query = searchInput.value.toLowerCase();
        return rows.filter(row => row.textContent.toLowerCase().includes(query));
    }

    searchInput.addEventListener('input', () => renderTable(getFilteredRows(), 1));

    renderTable(rows);
});
</script>

{% endblock %}
